{
  "info": {
    "name": "Predictive Maintenance API",
    "description": "API Collection for Predictive Maintenance Backend with Supabase Authentication",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "predictive-maintenance"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{accessToken}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Sign Up",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.session && jsonData.session.access_token) {",
                  "        pm.environment.set('accessToken', jsonData.session.access_token);",
                  "        pm.environment.set('refreshToken', jsonData.session.refresh_token);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"password123\",\n  \"fullName\": \"Test User\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/signup",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "signup"]
            },
            "description": "Register a new user account"
          },
          "response": []
        },
        {
          "name": "Sign In",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.environment.set('accessToken', jsonData.accessToken);",
                  "    pm.environment.set('refreshToken', jsonData.refreshToken);",
                  "    pm.environment.set('userId', jsonData.user.id);",
                  "    pm.environment.set('userEmail', jsonData.user.email);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/signin",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "signin"]
            },
            "description": "Login with email and password"
          },
          "response": []
        },
        {
          "name": "Get Profile (Me)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "me"]
            },
            "description": "Get current user profile (requires authentication)"
          },
          "response": []
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.environment.set('accessToken', jsonData.accessToken);",
                  "    pm.environment.set('refreshToken', jsonData.refreshToken);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            },
            "description": "Get new access token using refresh token"
          },
          "response": []
        },
        {
          "name": "Reset Password",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/reset-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "reset-password"]
            },
            "description": "Send password reset email"
          },
          "response": []
        },
        {
          "name": "Sign Out",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/signout",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "signout"]
            },
            "description": "Logout current user (requires authentication)"
          },
          "response": []
        },
        {
          "name": "Verify Email Page",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/verify-email#access_token=YOUR_ACCESS_TOKEN&refresh_token=YOUR_REFRESH_TOKEN&type=signup",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "verify-email"],
              "hash": "access_token=YOUR_ACCESS_TOKEN&refresh_token=YOUR_REFRESH_TOKEN&type=signup"
            },
            "description": "Returns HTML page that automatically verifies email using tokens from URL hash fragment. This endpoint is called from email confirmation link."
          },
          "response": []
        },
        {
          "name": "Verify Email Callback",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"refreshToken\": \"refresh_token_here\",\n  \"type\": \"signup\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/verify-email/callback",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "verify-email", "callback"]
            },
            "description": "Backend endpoint that receives parsed tokens from JavaScript and verifies the user's email by checking with Supabase and creating user in local database."
          },
          "response": []
        },
        {
          "name": "Resend Verification Email",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user@example.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/resend-verification",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "resend-verification"]
            },
            "description": "Resend email verification to user who hasn't verified their email yet."
          },
          "response": []
        }
      ],
      "description": "Authentication endpoints using Supabase"
    },
    {
      "name": "Machines",
      "item": [
        {
          "name": "Create Machine",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.environment.set('machineId', jsonData.id);",
                  "    pm.environment.set('productId', jsonData.productId);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"productId\": \"M14860\",\n  \"type\": \"M\",\n  \"name\": \"CNC Machine 001\",\n  \"description\": \"High precision CNC machine for metal cutting\",\n  \"location\": \"Factory Floor A\",\n  \"installationDate\": \"2024-01-15T00:00:00Z\",\n  \"status\": \"operational\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/machines",
              "host": ["{{baseUrl}}"],
              "path": ["machines"]
            },
            "description": "Create new machine (requires admin or operator role)"
          },
          "response": []
        },
        {
          "name": "Get All Machines",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/machines?limit=50&offset=0",
              "host": ["{{baseUrl}}"],
              "path": ["machines"],
              "query": [
                {
                  "key": "limit",
                  "value": "50"
                },
                {
                  "key": "offset",
                  "value": "0"
                },
                {
                  "key": "search",
                  "value": "M14860",
                  "disabled": true
                },
                {
                  "key": "type",
                  "value": "M",
                  "disabled": true
                },
                {
                  "key": "status",
                  "value": "operational",
                  "disabled": true
                },
                {
                  "key": "location",
                  "value": "Factory Floor A",
                  "disabled": true
                },
                {
                  "key": "includeStats",
                  "value": "true",
                  "disabled": true
                }
              ]
            },
            "description": "Get list of machines with optional filters"
          },
          "response": []
        },
        {
          "name": "Get Machine by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/machines/{{machineId}}",
              "host": ["{{baseUrl}}"],
              "path": ["machines", "{{machineId}}"]
            },
            "description": "Get machine details by ID"
          },
          "response": []
        },
        {
          "name": "Get Machine Statistics",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/machines/{{machineId}}/stats",
              "host": ["{{baseUrl}}"],
              "path": ["machines", "{{machineId}}", "stats"]
            },
            "description": "Get machine statistics including sensor readings and predictions count"
          },
          "response": []
        },
        {
          "name": "Update Machine",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"maintenance\",\n  \"lastMaintenanceDate\": \"2025-11-12T00:00:00Z\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/machines/{{machineId}}",
              "host": ["{{baseUrl}}"],
              "path": ["machines", "{{machineId}}"]
            },
            "description": "Update machine (partial update, requires admin or operator role)"
          },
          "response": []
        },
        {
          "name": "Delete Machine",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/machines/{{machineId}}",
              "host": ["{{baseUrl}}"],
              "path": ["machines", "{{machineId}}"]
            },
            "description": "Delete machine (requires admin role)"
          },
          "response": []
        }
      ],
      "description": "Machine management endpoints"
    },
    {
      "name": "Sensors",
      "item": [
        {
          "name": "Create Sensor Reading",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.environment.set('sensorUdi', jsonData.udi);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"machineId\": \"{{machineId}}\",\n  \"productId\": \"M14860\",\n  \"airTemp\": 298.1,\n  \"processTemp\": 308.6,\n  \"rotationalSpeed\": 1551,\n  \"torque\": 42.8,\n  \"toolWear\": 0\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/sensors",
              "host": ["{{baseUrl}}"],
              "path": ["sensors"]
            },
            "description": "Create single sensor reading (requires admin or operator role)"
          },
          "response": []
        },
        {
          "name": "Batch Create Sensor Readings",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"readings\": [\n    {\n      \"machineId\": \"{{machineId}}\",\n      \"productId\": \"M14860\",\n      \"airTemp\": 298.1,\n      \"processTemp\": 308.6,\n      \"rotationalSpeed\": 1551,\n      \"torque\": 42.8,\n      \"toolWear\": 0\n    },\n    {\n      \"machineId\": \"{{machineId}}\",\n      \"productId\": \"M14861\",\n      \"airTemp\": 298.2,\n      \"processTemp\": 308.7,\n      \"rotationalSpeed\": 1552,\n      \"torque\": 42.9,\n      \"toolWear\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/sensors/batch",
              "host": ["{{baseUrl}}"],
              "path": ["sensors", "batch"]
            },
            "description": "Create multiple sensor readings at once (max 100, requires admin or operator role)"
          },
          "response": []
        },
        {
          "name": "Get All Sensor Readings",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/sensors?limit=100&offset=0",
              "host": ["{{baseUrl}}"],
              "path": ["sensors"],
              "query": [
                {
                  "key": "limit",
                  "value": "100"
                },
                {
                  "key": "offset",
                  "value": "0"
                },
                {
                  "key": "machineId",
                  "value": "{{machineId}}",
                  "disabled": true
                },
                {
                  "key": "startDate",
                  "value": "2025-11-01T00:00:00Z",
                  "disabled": true
                },
                {
                  "key": "endDate",
                  "value": "2025-11-12T23:59:59Z",
                  "disabled": true
                }
              ]
            },
            "description": "Get sensor readings with optional filters (machineId, date range)"
          },
          "response": []
        },
        {
          "name": "Get Sensor Reading by UDI",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/sensors/{{sensorUdi}}",
              "host": ["{{baseUrl}}"],
              "path": ["sensors", "{{sensorUdi}}"]
            },
            "description": "Get sensor reading details by UDI (unique data identifier)"
          },
          "response": []
        },
        {
          "name": "Get Sensor Statistics by Machine",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/sensors/statistics/{{machineId}}",
              "host": ["{{baseUrl}}"],
              "path": ["sensors", "statistics", "{{machineId}}"]
            },
            "description": "Get sensor statistics for a machine (min, max, avg, median for last 100 readings)"
          },
          "response": []
        },
        {
          "name": "Delete Sensor Reading",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/sensors/{{sensorUdi}}",
              "host": ["{{baseUrl}}"],
              "path": ["sensors", "{{sensorUdi}}"]
            },
            "description": "Delete sensor reading (requires admin role)"
          },
          "response": []
        }
      ],
      "description": "Sensor readings management endpoints"
    },
    {
      "name": "Health Check",
      "item": [
        {
          "name": "Get App Info",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/",
              "host": ["{{baseUrl}}"],
              "path": [""]
            },
            "description": "Get basic app information"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Chat",
      "item": [
        {
          "name": "AI Test - Multi Machine Overheating Query",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"message\": \"Mesin mana saja yang berisiko overheat 3 hari kedepan?\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/chat",
              "host": ["{{baseUrl}}"],
              "path": ["chat"]
            },
            "description": "Test multi-machine query with overheating risk analysis"
          },
          "response": []
        },
        {
          "name": "AI Test - Single Machine Status Query",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"message\": \"Bagaimana kondisi mesin M14860 saat ini?\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/chat",
              "host": ["{{baseUrl}}"],
              "path": ["chat"]
            },
            "description": "Test single machine condition analysis"
          },
          "response": []
        },
        {
          "name": "AI Test - Location-Based Query",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"message\": \"Mesin di Factory Floor A yang perlu maintenance?\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/chat",
              "host": ["{{baseUrl}}"],
              "path": ["chat"]
            },
            "description": "Test location-based multi-machine analysis"
          },
          "response": []
        },
        {
          "name": "AI Test - Vague Query (Should Ask Clarification)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"message\": \"Bagaimana kondisi mesinnya?\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/chat",
              "host": ["{{baseUrl}}"],
              "path": ["chat"]
            },
            "description": "Test vague query that should trigger clarification request"
          },
          "response": []
        },
        {
          "name": "Get Chat Messages",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/chat?limit=50&offset=0",
              "host": ["{{baseUrl}}"],
              "path": ["chat"],
              "query": [
                {
                  "key": "limit",
                  "value": "50",
                  "description": "Number of messages to retrieve (max 100, default 50)"
                },
                {
                  "key": "offset",
                  "value": "0",
                  "description": "Number of messages to skip for pagination"
                }
              ]
            },
            "description": "Retrieve all chat messages for the authenticated user with pagination.\n\nQuery parameters:\n- limit (number, optional): Max 100, default 50\n- offset (number, optional): For pagination, default 0\n\nResponse:\n- data (array): List of chat messages\n  - id (UUID): Message ID\n  - role (string): 'user' or 'assistant'\n  - content (string): Message content\n  - createdAt (ISO string): When message was created\n- meta (object): Pagination metadata\n  - total (number): Total messages count\n  - limit (number): Current limit\n  - offset (number): Current offset\n  - hasMore (boolean): Whether more messages exist"
          },
          "response": []
        }
      ],
      "description": "Chat endpoints for AI chatbot. Messages and responses are automatically persisted to database."
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    }
  ]
}
